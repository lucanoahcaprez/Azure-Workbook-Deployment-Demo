{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "metadata": {
    "lastUpdated": "2025-09-22T07:28:14Z",
    "generatedBy": "Local combine-workbook.ps1 script",
    "description": "ARM Template for deploying Azure Workbook Template - Sample Dashboard WPNinjas 2025",
    "workbookSize": 38632,
    "workbookContentHash": "669FB9BDE670D43BF8755D4E95FEDB14905F21F0B3E09C8FE960DCA6AC05BD4E"
  },
  "parameters": {
    "workbookId": {
      "defaultValue": "[newGuid()]",
      "type": "string",
      "metadata": {
        "description": "The unique guid for this workbook template instance"
      }
    },
    "location": {
      "defaultValue": "[resourceGroup().location]",
      "type": "string",
      "metadata": {
        "description": "Location for all resources."
      }
    },
    "templateName": {
      "defaultValue": "A Workbook Template",
      "type": "string",
      "metadata": {
        "description": "The name for the workbook template in the gallery."
      }
    },
    "templateCategory": {
      "defaultValue": "Deployed Templates",
      "type": "string",
      "metadata": {
        "description": "The category for the workbook template in the gallery."
      }
    },
    "workbookDisplayName": {
      "defaultValue": "Sample Dashboard WPNinjas 2025",
      "type": "string",
      "metadata": {
        "description": "The friendly name for the workbook template that is used in the Gallery or Saved List."
      }
    },
    "resourceTags": {
      "defaultValue": {
        "CreatedBy": "ARM Template",
        "Environment": "Demo",
        "Project": "Azure-Workbook-Deployment-Demo"
      },
      "type": "object",
      "metadata": {
        "description": "Tags to apply to the workbook resource"
      }
    }
  },
  "variables": {},
  "resources": [
    {
      "tags": "[parameters('resourceTags')]",
      "name": "[parameters('workbookId')]",
      "location": "[parameters('location')]",
      "kind": "shared",
      "type": "microsoft.insights/workbooktemplates",
      "properties": {
        "templateData": {
          "version": "Notebook/1.0",
          "items": [
            {
              "type": 9,
              "content": {
                "version": "KqlParameterItem/1.0",
                "crossComponentResources": [
                  "{LogAnalyticsWorkspaces}"
                ],
                "parameters": [
                  {
                    "id": "4fe97648-1a49-4fd7-a4a6-20c6a2327bd3",
                    "version": "KqlParameterItem/1.0",
                    "name": "TimeRange",
                    "label": "Time Range",
                    "type": 4,
                    "isGlobal": true,
                    "typeSettings": {
                      "selectableValues": [
                        {
                          "durationMs": 1800000
                        },
                        {
                          "durationMs": 3600000
                        },
                        {
                          "durationMs": 14400000
                        },
                        {
                          "durationMs": 43200000
                        },
                        {
                          "durationMs": 86400000
                        },
                        {
                          "durationMs": 172800000
                        },
                        {
                          "durationMs": 259200000
                        },
                        {
                          "durationMs": 604800000
                        },
                        {
                          "durationMs": 1209600000
                        },
                        {
                          "durationMs": 2592000000
                        }
                      ],
                      "allowCustom": true
                    },
                    "timeContext": {
                      "durationMs": 86400000
                    },
                    "value": {
                      "durationMs": 604800000
                    }
                  },
                  {
                    "id": "e2c82b9c-bcaf-462f-915e-11c773156800",
                    "version": "KqlParameterItem/1.0",
                    "name": "Subscriptions",
                    "type": 6,
                    "isRequired": true,
                    "multiSelect": true,
                    "quote": "'",
                    "delimiter": ",",
                    "typeSettings": {
                      "additionalResourceOptions": [
                        "value::all"
                      ],
                      "includeAll": true
                    },
                    "defaultValue": "value::all"
                  },
                  {
                    "id": "38e9a996-2ba5-44e5-a1a6-fcbf670370d2",
                    "version": "KqlParameterItem/1.0",
                    "name": "LogAnalyticsWorkspaces",
                    "label": "Log Analytics Workspaces",
                    "type": 5,
                    "isRequired": true,
                    "multiSelect": true,
                    "quote": "'",
                    "delimiter": ",",
                    "query": "resources\r\n| where type =~ 'microsoft.operationalinsights/workspaces'\r\n| project id",
                    "crossComponentResources": [
                      "{Subscriptions}"
                    ],
                    "typeSettings": {
                      "resourceTypeFilter": {
                        "microsoft.operationalinsights/workspaces": true
                      },
                      "additionalResourceOptions": [
                        "value::all"
                      ],
                      "showDefault": false
                    },
                    "defaultValue": "value::all",
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources",
                    "value": [
                      "value::all"
                    ]
                  },
                  {
                    "id": "b52f0933-be39-49be-82e1-7d37262f3670",
                    "version": "KqlParameterItem/1.0",
                    "name": "OSSelection",
                    "label": "Operating System",
                    "type": 2,
                    "isRequired": true,
                    "isGlobal": true,
                    "multiSelect": true,
                    "quote": "'",
                    "delimiter": ",",
                    "query": "IntuneDevices\r\n| distinct OS",
                    "crossComponentResources": [
                      "{LogAnalyticsWorkspaces}"
                    ],
                    "typeSettings": {
                      "additionalResourceOptions": [
                        "value::all"
                      ],
                      "showDefault": false
                    },
                    "timeContext": {
                      "durationMs": 0
                    },
                    "timeContextFromParameter": "TimeRange",
                    "defaultValue": "value::all",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "value": [
                      "value::all"
                    ]
                  },
                  {
                    "id": "1feac0c0-9dcf-476f-a739-1be6bec3020b",
                    "version": "KqlParameterItem/1.0",
                    "name": "ExtendedDeviceFilter",
                    "type": 1,
                    "isHiddenWhenLocked": true,
                    "timeContext": {
                      "durationMs": 0
                    },
                    "timeContextFromParameter": "TimeRange",
                    "defaultValue": "| where ManagedBy != \"MDE\"",
                    "value": "| where ManagedBy != \"MDE\""
                  },
                  {
                    "id": "ef1ffc33-11eb-439e-b47a-599e83f427fa",
                    "version": "KqlParameterItem/1.0",
                    "name": "LastIntuneDiagnosticsImport",
                    "type": 1,
                    "isRequired": true,
                    "query": "IntuneDevices\r\n| where OS in ({OSSelection})\r\n{ExtendedDeviceFilter}| extend SwissTime = tostring(format_datetime(TimeGenerated, 'dd.MM.yyyy HH:mm:ss'))\r\n| project SwissTime\r\n| take 1",
                    "crossComponentResources": [
                      "{LogAnalyticsWorkspaces}"
                    ],
                    "isHiddenWhenLocked": true,
                    "timeContext": {
                      "durationMs": 0
                    },
                    "timeContextFromParameter": "TimeRange",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces"
                  },
                  {
                    "id": "a139aff3-827b-4783-8090-7da0d7528b4e",
                    "version": "KqlParameterItem/1.0",
                    "name": "ConsideredActiveDays",
                    "type": 4,
                    "isRequired": true,
                    "isGlobal": true,
                    "isHiddenWhenLocked": true,
                    "typeSettings": {
                      "selectableValues": [
                        {
                          "durationMs": 86400000
                        },
                        {
                          "durationMs": 259200000
                        },
                        {
                          "durationMs": 604800000
                        },
                        {
                          "durationMs": 1209600000
                        },
                        {
                          "durationMs": 2592000000
                        },
                        {
                          "durationMs": 5184000000
                        },
                        {
                          "durationMs": 7776000000
                        }
                      ]
                    },
                    "timeContext": {
                      "durationMs": 0
                    },
                    "timeContextFromParameter": "TimeRange",
                    "value": {
                      "durationMs": 604800000
                    }
                  },
                  {
                    "id": "be336a04-057b-4e11-87a4-68d615778b6f",
                    "version": "KqlParameterItem/1.0",
                    "name": "AzureFunctionVersion",
                    "type": 9,
                    "isRequired": true,
                    "isGlobal": true,
                    "multiSelect": true,
                    "quote": "'",
                    "delimiter": ",",
                    "query": "let rawData = externaldata(AzureFunctionVersion:string)[   'https://func-lnc-kpidashboard-test-chn-02.azurewebsites.net/api/func-lnc-sampledashboardwpninjas2025-test-chn-01?code=LEgx35VLo9k5xFSZhH0lSMqOC-jvpN4KsNr00SJ2kBENAzFuJYLfLQ==&evaluationType=azurefunctionversion']with(format='multijson');rawData | extend AzureFunctionVersion = tostring(AzureFunctionVersion)",
                    "crossComponentResources": [
                      "{LogAnalyticsWorkspaces}"
                    ],
                    "isHiddenWhenLocked": true,
                    "timeContext": {
                      "durationMs": 0
                    },
                    "timeContextFromParameter": "TimeRange",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "value": [
                      "1.0.4"
                    ]
                  }
                ],
                "style": "pills",
                "queryType": 0,
                "resourceType": "microsoft.operationalinsights/workspaces"
              },
              "name": "parameters - 0"
            },
            {
              "type": 11,
              "content": {
                "version": "LinkItem/1.0",
                "style": "tabs",
                "tabStyle": "bigger",
                "links": [
                  {
                    "id": "cd561c05-b63a-4087-8069-68c384b226ef",
                    "cellValue": "GroupName",
                    "linkTarget": "parameter",
                    "linkLabel": "Sample Dashboard Overview",
                    "subTarget": "SampleDashboardOverview",
                    "preText": "KPI Overview",
                    "style": "link"
                  },
                  {
                    "id": "673edfdf-bedc-4706-9c3a-c2b1e98fe395",
                    "cellValue": "GroupName",
                    "linkTarget": "parameter",
                    "linkLabel": "Example Tab 1",
                    "subTarget": "ExampleTab1",
                    "style": "link"
                  }
                ]
              },
              "name": "mainnavbar",
              "styleSettings": {
                "margin": "0",
                "padding": "0"
              }
            },
            {
              "type": 12,
              "content": {
                "version": "NotebookGroup/1.0",
                "groupType": "editable",
                "items": [
                  {
                    "type": 1,
                    "content": {
                      "json": "<div style=\"font-family:'Segoe UI', sans-serif; background-color:#ffffff;\">\r\n  <div style=\"display: flex; justify-content: space-between; align-items: center;\">\r\n    <h2 style=\"color:#green; font-size:35px;\">Sample Dashboard WPNinjas 2025</h2>\r\n  <img src=\"https://summit.wpninjas.global/wp-content/uploads/2025/04/Global-NinjaSummit-BANNER.png\"  \r\n       alt=\"baseVISION Logo\" \r\n       style=\"background-color: #000; max-height: 200px; padding: 0px;\" />\r\n</div>\r\n\r\n  \r\n  <div style=\"display:flex; justify-content:space-between;  border-bottom:1px solid #000;\">\r\n    <div style=\"flex:1; padding:10px;\">\r\n      <h4>üõ† Intune Diagnostics</h4>\r\n      <p><strong>Last Import:</strong> <span>{LastIntuneDiagnosticsImport}</span></p>\r\n    </div>\r\n    <div style=\"flex:1; padding:10px;\">\r\n      <h4>üîÑ Windows Update</h4>\r\n      <p><strong>Last Report:</strong> <span>{LastWindowsUpdateReport}</span></p>\r\n    </div>\r\n    <div style=\"flex:1; padding:10px;\">\r\n      <h4>‚öôÔ∏è Versions</h4>\r\n      <p><strong>KQL Dashboard:</strong> <span>'1.0.11'</span></p>\r\n      <p><strong>Azure Function:</strong> <span>{AzureFunctionVersion}</span></p>\r\n    </div>\r\n  </div>\r\n</div>"
                    },
                    "name": "text - 3"
                  },
                  {
                    "type": 3,
                    "content": {
                      "version": "KqlItem/1.0",
                      "query": "IntuneDevices\r\n| where OS in ({OSSelection})\r\n{ExtendedDeviceFilter}| where todatetime(LastContact) {ConsideredActiveDays:value}\r\n| summarize UniqueDeviceCount = dcount(DeviceId)",
                      "size": 4,
                      "title": "Active Devices Intune (Count) - Logs",
                      "timeContextFromParameter": "TimeRange",
                      "queryType": 0,
                      "resourceType": "microsoft.operationalinsights/workspaces",
                      "crossComponentResources": [
                        "{LogAnalyticsWorkspaces}"
                      ],
                      "visualization": "stat",
                      "statSettings": {
                        "valueAggregation": "None",
                        "valueTooltipSettings": {
                          "tooltip": "This is how many users you have in Entra ID."
                        },
                        "colorSettings": {
                          "type": "static",
                          "mode": "foreground",
                          "heatmapPalette": "greenRed",
                          "thresholdsGrid": []
                        },
                        "iconSettings": {
                          "thresholdsGrid": [
                            {
                              "operator": ">=",
                              "thresholdValue": "0",
                              "representation": "Signout"
                            }
                          ]
                        },
                        "tagText": "",
                        "valueFontStyle": "auto"
                      }
                    },
                    "customWidth": "12.5",
                    "name": "Active Devices Intune (Count) - Logs",
                    "styleSettings": {
                      "maxWidth": "12.5"
                    }
                  },
                  {
                    "type": 3,
                    "content": {
                      "version": "KqlItem/1.0",
                      "query": "{\"version\":\"MsGraphEndpoint/1.0\",\"data\":null,\"headers\":[{\"key\":\"ConsistencyLevel\",\"value\":\"eventual\"}],\"method\":\"GET\",\"path\":\"/beta/devicemanagement/managedDevices\",\"urlParams\":[{\"key\":\"$count\",\"value\":\"true\"},{\"key\":\"$filter\",\"value\":\"lastSyncDateTime ge {ConsideredActiveDays:startISO}\"}],\"transformers\":[{\"type\":\"jsonpath\",\"settings\":{\"tablePath\":\"\",\"columns\":[{\"path\":\"$..['@odata.count']\",\"columnid\":\"Count\",\"columnType\":\"long\"}]}}]}",
                      "size": 4,
                      "title": "Active intune Device (Count) - Graph",
                      "exportToExcelOptions": "all",
                      "queryType": 14,
                      "visualization": "stat",
                      "gridSettings": {
                        "formatters": [
                          {
                            "columnMatch": "Assigned",
                            "formatter": 0,
                            "formatOptions": {
                              "aggregation": "Count"
                            }
                          }
                        ]
                      },
                      "sortBy": [],
                      "tileSettings": {
                        "titleContent": {},
                        "leftContent": {
                          "columnMatch": "JailBrokenCount",
                          "formatter": 8,
                          "formatOptions": {
                            "min": 0,
                            "max": 1,
                            "palette": "red",
                            "linkTarget": "GenericDetails",
                            "linkIsContextBlade": true
                          }
                        },
                        "showBorder": true,
                        "size": "auto",
                        "styleSettings": {
                          "borderStyle": "rounded"
                        }
                      },
                      "statSettings": {
                        "valueAggregation": "Count",
                        "colorSettings": {
                          "type": "static",
                          "mode": "foreground",
                          "heatmapPalette": "greenRed",
                          "heatmapMin": 0,
                          "heatmapMax": 1,
                          "thresholdsGrid": []
                        },
                        "iconSettings": {
                          "thresholdsGrid": [
                            {
                              "operator": ">=",
                              "thresholdValue": "0",
                              "representation": "PersonWithFriend"
                            }
                          ]
                        },
                        "tagText": "",
                        "valueFontStyle": "auto",
                        "valueTooltipSettings": {
                          "tooltip": "The number of all Applications which are not assigned."
                        },
                        "valueField": "Count"
                      }
                    },
                    "customWidth": "12.5",
                    "name": "Active intune Device (Count) - Graph",
                    "styleSettings": {
                      "maxWidth": "12.5"
                    }
                  },
                  {
                    "type": 3,
                    "content": {
                      "version": "KqlItem/1.0",
                      "query": "IntuneDevices\r\n| where OS in ({OSSelection})\r\n{ExtendedDeviceFilter}| where todatetime(LastContact) {ConsideredActiveDays:value}\r\n| summarize \r\n    TotalDevices = count(),\r\n    CompliantDevices = countif(CompliantState == \"Compliant\")\r\n| extend CompliancePercentage = (todouble(CompliantDevices) / TotalDevices * 100)\r\n| project CompliancePercentage",
                      "size": 4,
                      "title": "Active Intune Devices Compliance",
                      "timeContextFromParameter": "TimeRange",
                      "queryType": 0,
                      "resourceType": "microsoft.operationalinsights/workspaces",
                      "crossComponentResources": [
                        "{LogAnalyticsWorkspaces}"
                      ],
                      "visualization": "stat",
                      "statSettings": {
                        "valueField": "CompliancePercentage",
                        "valueAggregation": "None",
                        "colorSettings": {
                          "type": "static",
                          "mode": "background",
                          "heatmapPalette": "redGreen",
                          "heatmapMin": 90,
                          "heatmapMax": 100,
                          "thresholdsGrid": []
                        },
                        "iconSettings": {
                          "thresholdsGrid": [
                            {
                              "sourceColumn": "CompliancePercentage",
                              "operator": ">=",
                              "thresholdValue": "90",
                              "representation": "success"
                            },
                            {
                              "sourceColumn": "CompliancePercentage",
                              "operator": "<",
                              "thresholdValue": "90",
                              "representation": "3"
                            }
                          ]
                        },
                        "numberFormatSettings": {
                          "unit": 1,
                          "options": {
                            "style": "decimal",
                            "useGrouping": true,
                            "maximumFractionDigits": 2
                          }
                        },
                        "tagText": "",
                        "valueFontStyle": "auto"
                      }
                    },
                    "customWidth": "12.5",
                    "showPin": false,
                    "name": "Active Intune Devices Compliance",
                    "styleSettings": {
                      "maxWidth": "12.5"
                    }
                  },
                  {
                    "type": 3,
                    "content": {
                      "version": "KqlItem/1.0",
                      "query": "IntuneDevices\r\n| where OS in ({OSSelection})\r\n| join kind=inner (\r\n    UCClient\r\n) on $left.ReferenceId == $right.AzureADDeviceId\r\n| summarize \r\n    TotalDevices = count(),\r\n    CompliantDevices = countif(tostring(OSSecurityUpdateStatus) == \"Latest\")\r\n| extend CompliancePercentage = case(\r\n    TotalDevices == 0, 0.0,\r\n    isnan(todouble(CompliantDevices) / TotalDevices * 100), 0.0,\r\n    todouble(CompliantDevices) / TotalDevices * 100\r\n)\r\n| project CompliancePercentage",
                      "size": 4,
                      "title": "Device OS Update Benchmark",
                      "timeContextFromParameter": "TimeRange",
                      "queryType": 0,
                      "resourceType": "microsoft.operationalinsights/workspaces",
                      "crossComponentResources": [
                        "{LogAnalyticsWorkspaces}"
                      ],
                      "visualization": "stat",
                      "statSettings": {
                        "valueAggregation": "None",
                        "colorSettings": {
                          "type": "static",
                          "mode": "background",
                          "heatmapPalette": "greenRed",
                          "thresholdsGrid": []
                        },
                        "iconSettings": {
                          "thresholdsGrid": [
                            {
                              "sourceColumn": "CompliancePercentage",
                              "operator": ">=",
                              "thresholdValue": "90",
                              "representation": "success"
                            },
                            {
                              "sourceColumn": "CompliancePercentage",
                              "operator": "<",
                              "thresholdValue": "90",
                              "representation": "3"
                            }
                          ]
                        },
                        "numberFormatSettings": {
                          "unit": 1,
                          "options": {
                            "style": "decimal",
                            "useGrouping": true,
                            "maximumFractionDigits": 2
                          }
                        },
                        "tagText": "",
                        "valueFontStyle": "auto"
                      }
                    },
                    "customWidth": "12.5",
                    "name": "Device OS Update Benchmark",
                    "styleSettings": {
                      "maxWidth": "12.5"
                    }
                  },
                  {
                    "type": 3,
                    "content": {
                      "version": "KqlItem/1.0",
                      "query": "// Prepare the subtables\r\nlet UCServiceUpdateStatus_Info = UCServiceUpdateStatus | where UpdateCategory == \"DriverUpdate\" and ServiceState != \"Cancelled\" ;                               \r\nlet UCUpdateAlert_Info = UCUpdateAlert | where UpdateCategory == \"DriverUpdate\" and AlertStatus == \"Active\" ;\r\nlet UCClientUpdateStatus_Info = UCClientUpdateStatus | where UpdateCategory == \"DriverUpdate\" ;\r\nlet UCServiceClientUpdateStatus = UCServiceUpdateStatus_Info | join kind=leftouter (UCClientUpdateStatus_Info) on  AzureADDeviceId, CatalogId; \r\nlet UCDriverAlertsWithPolicyId = UCServiceUpdateStatus_Info | join kind=inner(UCUpdateAlert_Info) on  AzureADDeviceId, CatalogId;\r\n\r\n// Business logic\r\nlet AggregateDeviceCounts = UCServiceClientUpdateStatus\r\n| summarize \r\n    TotalDevices=dcount(AzureADDeviceId),\r\n    InstalledCount=dcountif(AzureADDeviceId, ClientState == \"Installed\") by PolicyId, CatalogId, UpdateClassification, UpdateDisplayName, DeploymentApprovedTime, UpdateManufacturer, ServiceState, ServiceSubstate, ClientState, ClientSubstate\r\n| extend TotalProgress=round((InstalledCount * 1.0/ TotalDevices) * 100, 1);\r\n\r\nlet AggregateAlertSubTypeCount = UCDriverAlertsWithPolicyId \r\n| summarize Alerts=dcount(ErrorCode) by PolicyId, CatalogId, DeploymentId,UpdateManufacturer, UpdateCategory, UpdateClassification, ServiceState, ServiceSubstate;\r\n\r\n// join for final output\r\nAggregateDeviceCounts\r\n| join kind=leftouter (AggregateAlertSubTypeCount) on PolicyId,CatalogId\r\n| summarize by PolicyId, CatalogId, DeploymentId,UpdateDisplayName, DeploymentApprovedTime, UpdateManufacturer, UpdateClassification, TotalProgress, Alerts, TotalDevices, UpdateCategory, ServiceState, ServiceSubstate, ClientState, ClientSubstate\r\n| summarize \r\n    CompliantDrivers = countif(todouble(TotalProgress) >= 90),\r\n    TotalDrivers = count()\r\n| extend CompliancePercentage = (todouble(CompliantDrivers) / todouble(TotalDrivers) * 100)\r\n| project CompliancePercentage",
                      "size": 4,
                      "title": "Device Driver Update Benchmark",
                      "timeContextFromParameter": "TimeRange",
                      "queryType": 0,
                      "resourceType": "microsoft.operationalinsights/workspaces",
                      "crossComponentResources": [
                        "{LogAnalyticsWorkspaces}"
                      ],
                      "visualization": "stat",
                      "statSettings": {
                        "valueAggregation": "None",
                        "colorSettings": {
                          "type": "static",
                          "mode": "background",
                          "heatmapPalette": "greenRed",
                          "thresholdsGrid": []
                        },
                        "iconSettings": {
                          "thresholdsGrid": [
                            {
                              "sourceColumn": "CompliancePercentage",
                              "operator": ">=",
                              "thresholdValue": "90",
                              "representation": "success"
                            },
                            {
                              "sourceColumn": "CompliancePercentage",
                              "operator": "<",
                              "thresholdValue": "90",
                              "representation": "3"
                            }
                          ]
                        },
                        "numberFormatSettings": {
                          "unit": 1,
                          "options": {
                            "style": "decimal",
                            "useGrouping": true,
                            "maximumFractionDigits": 2
                          }
                        },
                        "tagText": "",
                        "valueFontStyle": "auto"
                      }
                    },
                    "customWidth": "12.5",
                    "name": "Device Driver Update Benchmark",
                    "styleSettings": {
                      "maxWidth": "12.5"
                    }
                  },
                  {
                    "type": 3,
                    "content": {
                      "version": "KqlItem/1.0",
                      "query": "let rawData = externaldata(ApplicationId:string,  DisplayName:string, Platform_loc:string, FailedDevicePercentage:real, FailedDeviceCount:int, FailedUserCount:int, InstalledDeviceCount:int)\r\n[\r\n    'https://func-frqeizmvascwy.azurewebsites.net/api/kqldashboard-prod-01?code=5T4vhf8i4mVTAG19OLqUG2C8pYSz95YBi46t-yaV18CwAzFus4coOQ==&evaluationType=deviceManagement_reports_getAppsInstallSummaryReport'\r\n]\r\nwith(format='multijson');\r\n\r\nrawData\r\n| where Platform_loc in ({OSSelection})\r\n| summarize \r\n    CompliantDrivers = countif(todouble(FailedDevicePercentage) < 10),\r\n    TotalDrivers = count()\r\n| extend CompliancePercentage = (todouble(CompliantDrivers) / todouble(TotalDrivers) * 100)\r\n| project CompliancePercentage",
                      "size": 4,
                      "title": "Device Application Installation Benchmark",
                      "timeContextFromParameter": "TimeRange",
                      "queryType": 0,
                      "resourceType": "microsoft.operationalinsights/workspaces",
                      "crossComponentResources": [
                        "{LogAnalyticsWorkspaces}"
                      ],
                      "visualization": "stat",
                      "statSettings": {
                        "valueAggregation": "None",
                        "colorSettings": {
                          "type": "static",
                          "mode": "background",
                          "heatmapPalette": "greenRed",
                          "thresholdsGrid": []
                        },
                        "iconSettings": {
                          "thresholdsGrid": [
                            {
                              "sourceColumn": "CompliancePercentage",
                              "operator": ">=",
                              "thresholdValue": "90",
                              "representation": "success"
                            },
                            {
                              "sourceColumn": "CompliancePercentage",
                              "operator": "<",
                              "thresholdValue": "90",
                              "representation": "3"
                            }
                          ]
                        },
                        "numberFormatSettings": {
                          "unit": 1,
                          "options": {
                            "style": "decimal",
                            "useGrouping": true,
                            "maximumFractionDigits": 2
                          }
                        },
                        "tagText": "",
                        "valueFontStyle": "auto"
                      }
                    },
                    "customWidth": "12.5",
                    "name": "Device Application Installation Benchmark",
                    "styleSettings": {
                      "maxWidth": "12.5"
                    }
                  },
                  {
                    "type": 3,
                    "content": {
                      "version": "KqlItem/1.0",
                      "query": "{\"version\":\"MsGraphEndpoint/1.0\",\"data\":null,\"headers\":[{\"key\":\"ConsistencyLevel\",\"value\":\"eventual\"}],\"method\":\"GET\",\"path\":\"/beta/users\",\"urlParams\":[{\"key\":\"$count\",\"value\":\"true\"}],\"transformers\":[{\"type\":\"jsonpath\",\"settings\":{\"tablePath\":\"\",\"columns\":[{\"path\":\"$..['@odata.count']\",\"columnid\":\"Count\",\"columnType\":\"long\"}]}}]}",
                      "size": 4,
                      "title": "All Entra ID Users - Graph",
                      "exportToExcelOptions": "all",
                      "queryType": 14,
                      "visualization": "stat",
                      "gridSettings": {
                        "formatters": [
                          {
                            "columnMatch": "Assigned",
                            "formatter": 0,
                            "formatOptions": {
                              "aggregation": "Count"
                            }
                          }
                        ]
                      },
                      "sortBy": [],
                      "tileSettings": {
                        "titleContent": {},
                        "leftContent": {
                          "columnMatch": "JailBrokenCount",
                          "formatter": 8,
                          "formatOptions": {
                            "min": 0,
                            "max": 1,
                            "palette": "red",
                            "linkTarget": "GenericDetails",
                            "linkIsContextBlade": true
                          }
                        },
                        "showBorder": true,
                        "size": "auto",
                        "styleSettings": {
                          "borderStyle": "rounded"
                        }
                      },
                      "statSettings": {
                        "valueAggregation": "Count",
                        "colorSettings": {
                          "type": "static",
                          "mode": "foreground",
                          "heatmapPalette": "greenRed",
                          "heatmapMin": 0,
                          "heatmapMax": 1,
                          "thresholdsGrid": []
                        },
                        "iconSettings": {
                          "thresholdsGrid": [
                            {
                              "operator": ">=",
                              "thresholdValue": "0",
                              "representation": "PersonWithFriend"
                            }
                          ]
                        },
                        "tagText": "",
                        "valueFontStyle": "auto",
                        "valueTooltipSettings": {
                          "tooltip": "The number of all Applications which are not assigned."
                        },
                        "valueField": "Count"
                      }
                    },
                    "customWidth": "12.5",
                    "name": "All Entra ID Users - Graph",
                    "styleSettings": {
                      "maxWidth": "12.5"
                    }
                  },
                  {
                    "type": 3,
                    "content": {
                      "version": "KqlItem/1.0",
                      "query": "{\"version\":\"MsGraphEndpoint/1.0\",\"data\":null,\"headers\":[{\"key\":\"ConsistencyLevel\",\"value\":\"eventual\"}],\"method\":\"GET\",\"path\":\"/beta/users\",\"urlParams\":[{\"key\":\"$filter\",\"value\":\"userType eq 'Member'\"},{\"key\":\"$count\",\"value\":\"true\"}],\"transformers\":[{\"type\":\"jsonpath\",\"settings\":{\"tablePath\":\"\",\"columns\":[{\"path\":\"$..['@odata.count']\",\"columnid\":\"Count\",\"columnType\":\"long\"}]}}]}",
                      "size": 4,
                      "title": "Active Entra ID Members - Graph",
                      "exportToExcelOptions": "all",
                      "queryType": 14,
                      "visualization": "stat",
                      "gridSettings": {
                        "formatters": [
                          {
                            "columnMatch": "Assigned",
                            "formatter": 0,
                            "formatOptions": {
                              "aggregation": "Count"
                            }
                          }
                        ]
                      },
                      "sortBy": [],
                      "tileSettings": {
                        "titleContent": {},
                        "leftContent": {
                          "columnMatch": "JailBrokenCount",
                          "formatter": 8,
                          "formatOptions": {
                            "min": 0,
                            "max": 1,
                            "palette": "red",
                            "linkTarget": "GenericDetails",
                            "linkIsContextBlade": true
                          }
                        },
                        "showBorder": true,
                        "size": "auto",
                        "styleSettings": {
                          "borderStyle": "rounded"
                        }
                      },
                      "statSettings": {
                        "valueAggregation": "Count",
                        "colorSettings": {
                          "type": "static",
                          "mode": "foreground",
                          "heatmapPalette": "greenRed",
                          "heatmapMin": 0,
                          "heatmapMax": 1,
                          "thresholdsGrid": []
                        },
                        "iconSettings": {
                          "thresholdsGrid": [
                            {
                              "operator": ">=",
                              "thresholdValue": "0",
                              "representation": "PersonWithFriend"
                            }
                          ]
                        },
                        "tagText": "",
                        "valueFontStyle": "auto",
                        "valueTooltipSettings": {
                          "tooltip": "The number of all Applications which are not assigned."
                        },
                        "valueField": "Count"
                      }
                    },
                    "customWidth": "12.5",
                    "name": "Active Entra ID Members - Graph",
                    "styleSettings": {
                      "maxWidth": "12.5"
                    }
                  }
                ]
              },
              "conditionalVisibility": {
                "parameterName": "GroupName",
                "comparison": "isEqualTo",
                "value": "SampleDashboardOverview"
              },
              "name": "GroupName KPI Overview"
            },
            {
              "type": 12,
              "content": {
                "version": "NotebookGroup/1.0",
                "groupType": "editable",
                "items": [
                  {
                    "type": 3,
                    "content": {
                      "version": "KqlItem/1.0",
                      "query": "{\"version\":\"MsGraphEndpoint/1.0\",\"data\":null,\"headers\":[{\"key\":\"ConsitencyLevel\",\"value\":\"eventual\"}],\"method\":\"GET\",\"path\":\"/beta/deviceManagement/managedDevices\",\"urlParams\":[{\"key\":\"$filter\",\"value\":\"lastSyncDateTime ge {ConsideredActiveDays:startISO}\"},{\"key\":\"$select\",\"value\":\"id,deviceName,userPrincipalName,lastSyncDateTime,complianceState,operatingSystem,ownerType,Id\"},{\"key\":\"$top\",\"value\":\"999\"}],\"transformers\":[{\"type\":\"jsonpath\",\"settings\":{\"tablePath\":\"$.value\",\"columns\":[{\"path\":\"$.id\",\"columnid\":\"Device Name\",\"columnType\":\"string\"},{\"path\":\"$.lastSyncDateTime\",\"columnid\":\"Last_Sync_Date_Time\",\"columnType\":\"datetime\"},{\"path\":\"$.complianceState\",\"columnid\":\"Compliance_State\",\"columnType\":\"string\"},{\"path\":\"$.operatingSystem\",\"columnid\":\"Operating_System\",\"columnType\":\"string\"},{\"path\":\"$.ownerType\",\"columnid\":\"Owner_Type\",\"columnType\":\"string\"},{\"path\":\"$.id\",\"columnid\":\"ID\"}]}}]}",
                      "size": 0,
                      "title": "Active Intune Devices - Graph",
                      "showExportToExcel": true,
                      "queryType": 14,
                      "gridSettings": {
                        "formatters": [
                          {
                            "columnMatch": "Device_Name",
                            "formatter": 1,
                            "formatOptions": {
                              "workbookContext": {
                                "componentIdSource": "workbook",
                                "resourceIdsSource": "workbook",
                                "templateIdSource": "cell",
                                "typeSource": "workbook",
                                "gallerySource": "workbook",
                                "locationSource": "default",
                                "viewerMode": true
                              }
                            }
                          },
                          {
                            "columnMatch": "Compliance_State",
                            "formatter": 18,
                            "formatOptions": {
                              "thresholdsOptions": "icons",
                              "thresholdsGrid": [
                                {
                                  "operator": "==",
                                  "thresholdValue": "noncompliant",
                                  "representation": "4",
                                  "text": "{0}{1}"
                                },
                                {
                                  "operator": "Default",
                                  "thresholdValue": null,
                                  "representation": "success",
                                  "text": "{0}{1}"
                                }
                              ]
                            }
                          },
                          {
                            "columnMatch": "ID",
                            "formatter": 5
                          }
                        ],
                        "rowLimit": 1000,
                        "filter": true,
                        "labelSettings": [
                          {
                            "columnId": "Last_Sync_Date_Time",
                            "label": "Last Sync Date Time"
                          },
                          {
                            "columnId": "Compliance_State",
                            "label": "Compliance State"
                          },
                          {
                            "columnId": "Operating_System",
                            "label": "Operating System"
                          },
                          {
                            "columnId": "Owner_Type",
                            "label": "Owner Type"
                          }
                        ]
                      },
                      "sortBy": [],
                      "tileSettings": {
                        "titleContent": {},
                        "leftContent": {
                          "columnMatch": "JailBrokenCount",
                          "formatter": 8,
                          "formatOptions": {
                            "min": 0,
                            "max": 1,
                            "palette": "red",
                            "linkTarget": "GenericDetails",
                            "linkIsContextBlade": true
                          }
                        },
                        "showBorder": true,
                        "size": "auto",
                        "styleSettings": {
                          "borderStyle": "rounded"
                        }
                      },
                      "statSettings": {
                        "valueAggregation": "Count",
                        "colorSettings": {
                          "type": "static",
                          "mode": "foreground",
                          "heatmapPalette": "greenRed",
                          "heatmapMin": 0,
                          "heatmapMax": 1,
                          "thresholdsGrid": []
                        },
                        "iconSettings": {
                          "thresholdsGrid": [
                            {
                              "operator": ">=",
                              "thresholdValue": "0",
                              "representation": "PersonWithFriend"
                            }
                          ]
                        },
                        "tagText": "",
                        "valueFontStyle": "auto",
                        "valueTooltipSettings": {
                          "tooltip": "The number of all Applications which are not assigned."
                        },
                        "valueField": "Count"
                      }
                    },
                    "name": "Active Intune Devices - Graph"
                  }
                ]
              },
              "conditionalVisibility": {
                "parameterName": "GroupName",
                "comparison": "isEqualTo",
                "value": "ExampleTab1"
              },
              "customWidth": "50",
              "name": "group - 3"
            }
          ],
          "fallbackResourceIds": [
            "Azure Monitor"
          ],
          "fromTemplateId": "ArmTemplates-/subscriptions/b514a885-9f17-404b-93b1-21bd2693bd36/resourceGroups/rg-azure-workbook-demo/providers/microsoft.insights/workbooktemplates/e82bd957-c603-4b81-a981-8283cfe656a8",
          "$schema": "https://github.com/Microsoft/Application-Insights-Workbooks/blob/master/schema/workbook.json"
        },
        "galleries": [
          {
            "resourceType": "Azure Monitor",
            "name": "[parameters('templateName')]",
            "type": "workbook",
            "order": 100,
            "category": "[parameters('templateCategory')]"
          }
        ]
      },
      "apiVersion": "2020-11-20"
    }
  ],
  "outputs": {
    "workbookContentHash": {
      "type": "string",
      "value": "669FB9BDE670D43BF8755D4E95FEDB14905F21F0B3E09C8FE960DCA6AC05BD4E"
    },
    "workbookTemplateName": {
      "type": "string",
      "value": "[parameters('workbookDisplayName')]"
    },
    "workbookTemplateId": {
      "type": "string",
      "value": "[resourceId('microsoft.insights/workbooktemplates', parameters('workbookId'))]"
    }
  }
}